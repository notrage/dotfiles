#!/bin/bash

# Output script name
OUTPUT_SCRIPT="install_brew_packages.sh"

# Run brew list and save the output
BREW_FORMULAE=$(brew list --formulae)
BREW_CASKS=$(brew list --cask)

# Create the output script
echo "#!/bin/bash" > "$OUTPUT_SCRIPT"
echo "" >> "$OUTPUT_SCRIPT"
echo "# This script installs all listed Homebrew formulae and casks" >> "$OUTPUT_SCRIPT"
echo "set -e" >> "$OUTPUT_SCRIPT"
echo "" >> "$OUTPUT_SCRIPT"

# Process formulae
if [ -n "$BREW_FORMULAE" ]; then
  echo "echo 'Installing formulae...'" >> "$OUTPUT_SCRIPT"
  echo "brew install \\" >> "$OUTPUT_SCRIPT"
  echo "$BREW_FORMULAE" | sed 's/$/ \\/' >> "$OUTPUT_SCRIPT"
  sed -i '' '$ s/\\//' "$OUTPUT_SCRIPT"  # Remove trailing slash on the last line (macOS compatible)
  echo "" >> "$OUTPUT_SCRIPT"
fi

# Process casks
if [ -n "$BREW_CASKS" ]; then
  echo "echo 'Installing casks...'" >> "$OUTPUT_SCRIPT"
  echo "brew install --cask \\" >> "$OUTPUT_SCRIPT"
  echo "$BREW_CASKS" | sed 's/$/ \\/' >> "$OUTPUT_SCRIPT"
  sed -i '' '$ s/\\//' "$OUTPUT_SCRIPT"  # Remove trailing slash on the last line (macOS compatible)
  echo "" >> "$OUTPUT_SCRIPT"
fi

# Make the script executable
chmod +x "$OUTPUT_SCRIPT"

echo "Generated $OUTPUT_SCRIPT with install commands."
